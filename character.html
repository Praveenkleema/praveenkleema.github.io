<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>New Character</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./files/bootstrap.min.css">
    <link rel="stylesheet" href="./files/font-awesome.min.css">
    <link rel="stylesheet" href="./files/slick.css">
    <link rel="stylesheet" href="./files/slick-theme.css">
    <link rel="stylesheet" href="./files/owl.carousel.min.css">
    <link rel="stylesheet" href="./files/animate.min.css">
    <link rel="stylesheet" href="./files/magnific-popup.css">
    <link rel="stylesheet" href="./files/select2.min.css">
    <link rel="stylesheet" href="./files/select2-bootstrap4.min.css">
    <link rel="stylesheet" href="./files/slick-animation.css">
    <link rel="stylesheet" href="./files/style.css">
    <style>
        ::-webkit-scrollbar {
            width: 0.2vw;
        }

        ::-webkit-scrollbar-thumb {
            border-radius: 100vw;
            background: #f93742;
            ;
        }
    </style>
</head>

<body>
<link rel="stylesheet" href="./files/crud.css">

<div class="container">
    <h1 class="page_header">Create a New Character</h1>
    <form action="<%= server_main_url %>/characters/create_character" method="POST">
        <div class="form-row">
            <div class="input_">
                <h1>IMDB Id</h1>
                <input type="text" id="imdb_id" name="imdb_id" placeholder="IMDB ID" required>
            </div>
            <div class="input_">
                <h1>Name</h1>
                <input type="text" id="name" name="name" placeholder="Name" >
            </div>
        </div>
        <div class="form-row">
            <div class="input_">
                <h1>Year</h1>
                <input type="text" id="born_year" name="born_year" placeholder="Born Year">
            </div>
            <div class="input_">
                <h1>Bio</h1>
                <input type="text" id="bio" name="bio" placeholder="Bio">
            </div>
        </div>
        <div class="form-row">
            <div class="input_">
                <h1>Thumbnail Link</h1>
                <input type="text" id="thumbnail_link" name="thumbnail_link" placeholder="Thumbnail Link">
            </div>
            <div class="input_">
                <h1>Gender</h1>
                <input type="text" id="gender" name="gender" placeholder="Gender (Male/Female)">
            </div>
            <div class="input_">
                <h1>Is Pornstar</h1>
                <input type="text" id="is_pornstar" name="is_pornstar" value="no" placeholder="Is Pornstar (yes/no) Default: no">
            </div>
        </div>

        <h2>Images</h2>
        <div id="images_container" class="form-row">
            <div class="input_">
                <h1>Images</h1>
                <input type="text" id="image1" name="image_1" placeholder="Image_1">
            </div>
        </div>
        <button class="submit_btn" id="addMoreImgBtn">Add More Images</button>
        <button class="submit_btn" id="compileImgsBtn">Compile Images</button>
            
        <div class="form-row">
            <div class="input_">
                <input type="text" id="images" name="images" placeholder="[Warning] Do not edit this manually" required title="Click the Compile Images Button">
            </div>
        </div>
        <div class="form-row">
            <div class="input_">
                <input type="text" id="confirm" name="confirm" placeholder="Confirm this: type anything" required>
            </div>
        </div>
<!--         <button class="submit_btn">Create the Character</button> -->
    </form>

    <!-- Import Export Section -->

    <style>
        #importBtnLabel{
            background-color: rgb(176, 0, 150);
            padding: 10px 20px;
            border-radius: 20px;
            width: 120px;
            height: 45px;
            text-align: center;
            font-family: cursive;
            transition: 0.4s ease;
        }
        #importBtnLabel:hover{
            background-color: rgb(166, 0, 255);
        }
    </style>    

    <div class="import_export_section">
        <div class="import_container">
                <input hidden id="import_btn" type="file">
                <label id="importBtnLabel" for="import_btn">Import</label>
        </div>
        <button class="submit_btn" style="background-color: rgb(101, 0, 184);" id="export_btn">Export</button>
    </div>

</div>


<!-- Export and Import Script -->
<script>

    // Export Section - Done
    const exportBtn = document.getElementById("export_btn")
    exportBtn.addEventListener("click",(e)=>{
        e.preventDefault()
        const confirm = document.getElementById("confirm")

        const imdb_id = document.getElementById("imdb_id").value
        const name = document.getElementById("name").value
        const born_year = document.getElementById("born_year").value
        const bio =document.getElementById("bio").value 
        const thumbnail_link = document.getElementById("thumbnail_link").value
        const gender = document.getElementById("gender").value
        const is_pornstar = document.getElementById("is_pornstar").value
        const images = document.getElementById("images").value
        
        const details = {
            imdb_id:imdb_id,
            name:name,
            born_year:born_year,
            bio:bio,
            thumbnail_link:thumbnail_link,
            gender:gender,
            is_pornstar:is_pornstar,
            images:images
        }

        if (confirm.value != "" && images != ""){
            const link = document.createElement("a");
            const file = new Blob([JSON.stringify(details)], { type: 'text/plain' });
            link.href = URL.createObjectURL(file);
            link.download = "export_character.txt";
            link.click();
            URL.revokeObjectURL(link.href);
        }else{
            alert("Confirm Before Export, If you have done it to Click Compile Images Button")
        }
    })

    // Import Section
    const importInput = document.getElementById("import_btn")
    importInput.addEventListener("change",(e)=>{
        e.preventDefault()
        var fileReader_ =new FileReader();
        fileReader_.onload= ()=> {
            let jsonData = JSON.parse(fileReader_.result)
            const imdb_id = document.getElementById("imdb_id").value = jsonData["imdb_id"]
            const name = document.getElementById("name").value = jsonData["name"]
            const born_year = document.getElementById("born_year").value = jsonData["born_year"]
            const bio =document.getElementById("bio").value = jsonData["bio"] 
            const thumbnail_link = document.getElementById("thumbnail_link").value = jsonData["thumbnail_link"]
            const gender = document.getElementById("gender").value = jsonData["gender"]
            const is_pornstar = document.getElementById("is_pornstar").value = jsonData["is_pornstar"]
            const images = document.getElementById("images").value = jsonData["images"]
        }
              
        fileReader_.readAsText(e.target.files[0]);
    })


</script>

<script>
    const addMoreImgBtn = document.getElementById("addMoreImgBtn");
    const compileImgsBtn = document.getElementById("compileImgsBtn");
    const image_input_container = document.getElementById("images_container");
    let img_i = 1;
    
    addMoreImgBtn.addEventListener("click",(e)=>{
        const input = document.createElement("input");
        e.preventDefault();
        img_i = img_i + 1;
        const div = document.createElement("div");
        div.setAttribute("class", "input_");
        input.setAttribute("id", `image${img_i}`);
        input.setAttribute("name", `image_${img_i}`);
        input.setAttribute("placeholder", `Image_${img_i}`);
        div.appendChild(input);
        image_input_container.append(div);
    });
    
    compileImgsBtn.addEventListener("click",(e)=>{
        e.preventDefault();
        const imageInput = document.getElementById("images");
        let imgs = document.getElementById("image1").value;
        for (let i = 2; i <= img_i; i++) {
            let img_ = document.getElementById(`image${i}`)
            if (img_.value != "") {
                imgs = imgs + "," + img_.value;
            }
        }
        imageInput.value = imgs;
    });
    

</script>

</body>

</html>
